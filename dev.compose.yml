services:
  minerva:
    container_name: minerva
    image: myself/minerva:latest
    ports:
      - "3002:8080"
  wedcms:
    container_name: wedcms
    network_mode: host
    build:
      context: .
      dockerfile: Dockerfile
      target: dev
    ports:
      - "3000:3000"
    env_file:
      - apps/core/.env
    develop:
      watch:
        - action: sync
          path: ./apps/core/src
          target: /app/apps/core/src
        - action: sync+restart
          path: ./apps/core/views
          target: /app/apps/core/views
        - action: sync
          path: ./apps/core/public
          target: /app/apps/core/public
        - action: rebuild
          path: ./apps/core/package.json
    volumes:
      - ./apps/core/public/v14:/app/apps/core/public/v14
  housekeeping:
    container_name: housekeeping
    network_mode: host
    build:
      context: .
      dockerfile: Dockerfile
      target: housekeeping-dev
    develop:
      watch:
        - action: sync
          path: ./apps/housekeeping/src
          target: /app/apps/housekeeping/src
        - action: rebuild
          path: ./apps/housekeeping/package.json
